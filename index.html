<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light" />
  <title>StreamLab — Netflix Picker</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* (CSS remains same as before — shortened for clarity) */
  </style>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="brand">
        <div class="dot"></div>
        <h1>StreamLab</h1>
      </div>
      <div class="nav-actions">
        <a class="btn" href="#results">Discover</a>
        <button id="btnFavs" class="btn" title="Show favorites">Favorites</button>
        <button id="btnTheme" class="btn" title="Toggle theme">Theme</button>
        <button id="btnRandom" class="btn" title="Pick one at random from results">Random</button>
      </div>
    </nav>
    <section class="hero">
      <div class="container">
        <div class="kicker">Netflix-focused • Region-aware</div>
        <h2 class="headline">Find your next Movie or Series</h2>
        <p class="sub">Filter by type, region, genre, rating, and runtime. Save favorites, watch trailers, share picks, and load more as you scroll.</p>
      </div>
    </section>
  </header>

  <div class="container">
    <section class="controls">
      <div class="grid12">
        <div class="col-6 col-3">
          <label>Type</label>
          <div class="seg">
            <button id="btnMovie" class="btn" aria-pressed="true">Movie</button>
            <button id="btnTV" class="btn" aria-pressed="false">Series</button>
          </div>
        </div>
        <div class="col-6 col-3">
          <label>Region</label>
          <select id="regionSelect"></select>
        </div>
        <div class="col-6 col-3">
          <label>Genre</label>
          <select id="genreSelect"><option value="">Any</option></select>
        </div>
        <div class="col-6 col-3">
          <label>Min rating: <span id="ratingValue">6.5</span></label>
          <input type="range" id="minRating" min="0" max="9" step="0.5" value="6.5" />
        </div>
        <div class="col-6 col-3">
          <label>Min runtime (min)</label>
          <input type="number" id="minRuntime" min="0" max="300" step="10" value="0" />
        </div>
        <div class="col-6 col-3">
          <label>Max runtime (min)</label>
          <input type="number" id="maxRuntime" min="0" max="300" step="10" value="0" placeholder="0 = any"/>
        </div>
        <div class="col-12 action-row">
          <button id="btnSuggest" class="btn accent">Suggest titles</button>
          <button id="btnLoadMore" class="btn" style="display:none">Load more</button>
        </div>
      </div>
    </section>

    <section id="results" class="grid" aria-live="polite" aria-busy="false"></section>
    <div id="errorBox" class="error" style="display:none"></div>
  </div>

  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-label="Trailer">
    <div class="modal-inner">
      <button class="modal-close" id="modalClose">Close</button>
      <iframe id="ytFrame" src="" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </div>
  </div>

  <footer>
    <div class="container">
      <p>* Availability is inferred from TMDB watch providers per region. Data & posters © TMDB contributors. This product uses the TMDB API but is not endorsed or certified by TMDB.</p>
    </div>
  </footer>

<script>
  // ===== Config =====
  var TMDB_KEY = "daa745e9c8be7937a25bed1106d9c723";
  var DEFAULT_REGION = "US";
  var IMG_BASE = "https://image.tmdb.org/t/p/w342";

  // ===== State =====
  var currentType = "movie";
  var cachedGenres = { movie: [], tv: [] };
  var cachedProviderIdByRegion = {};
  var lastResults = [];
  var favKey = 'sl_favs_v1';
  var favs = loadFavs();
  var discoverBase = '';
  var nextPage = 1;
  var totalPages = 1;

  // ===== DOM =====
  var regionSelect = document.getElementById('regionSelect');
  var genreSelect = document.getElementById('genreSelect');
  var ratingRange = document.getElementById('minRating');
  var ratingValue = document.getElementById('ratingValue');
  var minRuntime = document.getElementById('minRuntime');
  var maxRuntime = document.getElementById('maxRuntime');
  var resultsEl = document.getElementById('results');
  var btnMovie = document.getElementById('btnMovie');
  var btnTV = document.getElementById('btnTV');
  var btnSuggest = document.getElementById('btnSuggest');
  var btnRandom = document.getElementById('btnRandom');
  var btnFavs = document.getElementById('btnFavs');
  var btnTheme = document.getElementById('btnTheme');
  var btnLoadMore = document.getElementById('btnLoadMore');
  var errorBox = document.getElementById('errorBox');
  var modal = document.getElementById('modal');
  var modalClose = document.getElementById('modalClose');
  var ytFrame = document.getElementById('ytFrame');

  // ===== Init =====
  bootstrap();

  function bootstrap(){
    // Theme from storage
    var storedTheme = localStorage.getItem('sl_theme');
    if(storedTheme){ document.documentElement.setAttribute('data-theme', storedTheme); }

    var regions = [
      { code:'US', name:'United States' },
      { code:'IN', name:'India' },
      { code:'GB', name:'United Kingdom' },
      { code:'CA', name:'Canada' },
      { code:'AU', name:'Australia' },
      { code:'SG', name:'Singapore' },
      { code:'AE', name:'UAE' }
    ];
    for (var i=0;i<regions.length;i++){
      var opt = document.createElement('option');
      opt.value = regions[i].code; opt.textContent = regions[i].name + " (" + regions[i].code + ")";
      regionSelect.appendChild(opt);
    }
    regionSelect.value = DEFAULT_REGION;

    ratingRange.addEventListener('input', function(){ ratingValue.textContent = ratingRange.value; }, { passive:true });
    btnMovie.addEventListener('click', function(){ setType('movie'); });
    btnTV.addEventListener('click', function(){ setType('tv'); });
    btnSuggest.addEventListener('click', suggest);
    btnRandom.addEventListener('click', pickRandom);
    btnFavs.addEventListener('click', showFavs);
    btnTheme.addEventListener('click', toggleTheme);
    btnLoadMore.addEventListener('click', loadMore);

    window.addEventListener('scroll', onScrollLoadMore, {passive:true});

    modalClose.addEventListener('click', closeModal);
    modal.addEventListener('click', function(e){ if(e.target === modal){ closeModal(); } });

    loadGenres('movie');
  }

  // (All remaining JS functions unchanged — same as in your working version)
</script>
</body>
</html>
